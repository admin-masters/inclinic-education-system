{% extends "base.html" %}

{% block title %}Manage Data Panel{% endblock %}

{% block content %}
<div class="container">
  <div class="dashboard-card">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
      <h5 class="mb-0">Manage Data Panel</h5>

      <div class="d-flex flex-column flex-sm-row gap-2">
        {# NOTE: change namespace here ONLY if your project uses admin-dashboard instead of admin_dashboard #}
        <a href="{% url 'admin_dashboard:fieldrep_list' %}" class="btn btn-sm btn-primary">
          <i class="bi bi-people me-1"></i>Admin Field Reps
        </a>

        <a href="{% url 'publisher_campaign_select' %}" class="btn btn-sm btn-info">
          <i class="bi bi-plus-circle me-1"></i>Add / Edit Campaign by ID
        </a>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th data-label="Campaign ID">Brand Campaign ID</th>
            <th data-label="Brand">Brand Name</th>
            <th data-label="Company" class="d-none d-md-table-cell">Company Name</th>
            <th data-label="Start Date">Start Date</th>
            <th data-label="End Date">End Date</th>
            <th data-label="Portal">Form / Portal</th>
            <th data-label="Actions" class="text-center">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for campaign in campaigns %}
          <tr>
            <td data-label="Campaign ID">
              <code class="text-primary">{{ campaign.brand_campaign_id }}</code>
            </td>

            <td data-label="Brand">
              <strong>{{ campaign.brand_name }}</strong>
            </td>

            <td data-label="Company" class="d-none d-md-table-cell">
              {{ campaign.company_name }}
            </td>

            <td data-label="Start Date">
              {% if campaign.start_date %}
                <small class="text-muted">{{ campaign.start_date }}</small>
              {% else %}
                <small class="text-muted">—</small>
              {% endif %}
            </td>

            <td data-label="End Date">
              {% if campaign.end_date %}
                <small class="text-muted">{{ campaign.end_date }}</small>
              {% else %}
                <small class="text-muted">—</small>
              {% endif %}
            </td>

            <td data-label="Portal">
              <div class="dropdown d-inline-block">
                <button class="btn btn-outline-primary btn-sm dropdown-toggle"
                        type="button"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                  <i class="bi bi-box-arrow-up-right me-1"></i>Open
                </button>

                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item"
                       href="{% url 'fieldrep_dashboard' %}?campaign={{ campaign.brand_campaign_id }}">
                      <i class="bi bi-file-text me-2"></i>Collateral Portal
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item"
                       href="{% url 'admin_dashboard:fieldrep_list' %}?campaign={{ campaign.brand_campaign_id }}">
                      <i class="bi bi-people me-2"></i>Field Rep Portal
                    </a>
                  </li>
                </ul>
              </div>
            </td>

            {# ✅ FIX: actions MUST be inside a <td> #}
            <td data-label="Actions" class="text-center">
              <div class="btn-group-sm d-flex flex-column flex-sm-row gap-1 justify-content-center" role="group">
                <a href="{% url 'campaign_by_id_detail' campaign.brand_campaign_id %}"
                   class="btn btn-sm btn-outline-secondary flex-fill">
                  <i class="bi bi-eye me-1"></i>View
                </a>

                <a href="{% url 'campaign_by_id_update' campaign.brand_campaign_id %}"
                   class="btn btn-sm btn-primary flex-fill">
                  <i class="bi bi-pencil me-1"></i>Edit
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-5">
              <i class="bi bi-inbox me-2"></i>No campaigns available.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>
</div>

<style>
@media (max-width: 767.98px) {
  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .table th,
  .table td {
    padding: var(--spacing-2) var(--spacing-3);
  }

  .btn-group-sm {
    flex-direction: column;
    width: 100%;
  }

  .btn-group-sm .btn {
    margin-bottom: var(--spacing-1);
  }

  .btn-group-sm .btn:last-child {
    margin-bottom: 0;
  }
}

@media (min-width: 768px) and (max-width: 991.98px) {
  .table th,
  .table td {
    padding: var(--spacing-2) var(--spacing-3);
    font-size: var(--font-size-sm);
  }
}

.dropdown-menu {
  min-width: 200px;
  font-size: var(--font-size-sm);
}

.dropdown-item {
  padding: var(--spacing-2) var(--spacing-3);
}

.dropdown-item i {
  width: 16px;
  text-align: center;
}

.btn-group-sm .btn {
  white-space: nowrap;
  font-size: var(--font-size-xs);
}

code {
  background-color: var(--background-light);
  padding: var(--spacing-1) var(--spacing-2);
  border-radius: var(--radius-base);
  font-size: var(--font-size-xs);
  border: 1px solid var(--border-color);
}
</style>
{% endblock %}
