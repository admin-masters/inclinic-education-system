{% extends "base.html" %}

{% block title %}Manage Data Panel{% endblock %}

{% block content %}
<div class="container">
  <div class="dashboard-card">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
      <h5 class="mb-0">Manage Data Panel</h5>

      <div class="d-flex flex-column flex-sm-row gap-2">
        {# NOTE: change namespace here ONLY if your project uses admin-dashboard instead of admin_dashboard #}
        <a href="{% url 'admin_dashboard:fieldrep_list' %}" class="btn btn-sm btn-primary">
          <i class="bi bi-people me-1"></i>Admin Field Reps
        </a>

{#        <a href="{% url 'publisher_campaign_select' %}" class="btn btn-sm btn-info">#}
{#          <i class="bi bi-plus-circle me-1"></i>Add / Edit Campaign by ID#}
{#        </a>#}
      </div>

    <!-- ðŸ” Filter & Search Section -->
    <form method="get" class="row g-2 align-items-end mb-4">
      <div class="col-12 col-md-4">
        <label class="form-label small text-muted">Search by Name or ID</label>
        <input type="text" name="q" value="{{ request.GET.q }}"
               class="form-control form-control-sm"
               placeholder="Enter Brand Name or Campaign ID">
      </div>

      <div class="col-6 col-md-3">
        <label class="form-label small text-muted">Start Date</label>
        <input type="date" name="start" value="{{ request.GET.start }}"
               class="form-control form-control-sm">
      </div>

      <div class="col-6 col-md-3">
        <label class="form-label small text-muted">End Date</label>
        <input type="date" name="end" value="{{ request.GET.end }}"
               class="form-control form-control-sm">
      </div>

      <div class="col-12 col-md-2 d-flex gap-2">
        <button type="submit" class="btn btn-sm btn-primary w-100">
          <i class="bi bi-funnel me-1"></i>Filter
        </button>
        <a href="{% url 'manage_data_panel' %}" class="btn btn-sm btn-outline-secondary w-100">
          Reset
        </a>
      </div>
    </form>
    </div>

    <div class="table-wrapper">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th data-label="Campaign ID">Brand Campaign ID</th>
            <th data-label="Brand">Brand Name</th>
            <th data-label="Company" class="d-none d-md-table-cell">Company Name</th>
            <th data-label="Start Date">Start Date</th>
            <th data-label="End Date">End Date</th>
            <th data-label="Actions" class="text-center">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for campaign in campaigns %}
          <tr>
            <td data-label="Campaign ID">
              <code class="text-primary">{{ campaign.brand_campaign_id }}</code>
            </td>

            <td data-label="Brand">
              <strong>{{ campaign.brand_name }}</strong>
            </td>

            <td data-label="Company" class="d-none d-md-table-cell">
              {{ campaign.company_name }}
            </td>

            <td data-label="Start Date">
              {% if campaign.start_date %}
                <small class="text-muted">{{ campaign.start_date }}</small>
              {% else %}
                <small class="text-muted">â€”</small>
              {% endif %}
            </td>

            <td data-label="End Date">
              {% if campaign.end_date %}
                <small class="text-muted">{{ campaign.end_date }}</small>
              {% else %}
                <small class="text-muted">â€”</small>
              {% endif %}
            </td>

            {# âœ… FIX: actions MUST be inside a <td> #}
            <td data-label="Actions" class="text-center">
              <div class="btn-group-sm d-flex flex-column flex-sm-row flex-wrap gap-1 justify-content-center" role="group">

                <!-- View (same tab) -->
                <a href="{% url 'campaign_by_id_detail' campaign.brand_campaign_id %}"
                   class="btn btn-sm btn-outline-secondary flex-fill">
                  <i class="bi bi-eye me-1"></i>View
                </a>

                <!-- Edit (same tab) -->
                <a href="{% url 'campaign_by_id_update' campaign.brand_campaign_id %}"
                   class="btn btn-sm btn-primary flex-fill">
                  <i class="bi bi-pencil me-1"></i>Edit
                </a>

                <!-- Collateral Portal (new tab) -->
                <a href="{% url 'fieldrep_dashboard' %}?campaign={{ campaign.brand_campaign_id }}"
                   target="_blank"
                   class="btn btn-sm btn-outline-primary flex-fill">
                  <i class="bi bi-file-text me-1"></i>Collateral
                </a>

                <!-- Field Rep Portal (new tab) -->
                <a href="{% url 'admin_dashboard:fieldrep_list' %}?campaign={{ campaign.brand_campaign_id }}"
                   target="_blank"
                   class="btn btn-sm btn-outline-dark flex-fill">
                  <i class="bi bi-people me-1"></i>Field Reps
                </a>

              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-5">
              <i class="bi bi-inbox me-2"></i>No campaigns available.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>
</div>

<style>
@media (max-width: 767.98px) {
  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .table th,
  .table td {
    padding: var(--spacing-2) var(--spacing-3);
  }

  .btn-group-sm {
    flex-direction: column;
    width: 100%;
  }

  .btn-group-sm .btn {
    margin-bottom: var(--spacing-1);
  }

  .btn-group-sm .btn:last-child {
    margin-bottom: 0;
  }
}

@media (min-width: 768px) and (max-width: 991.98px) {
  .table th,
  .table td {
    padding: var(--spacing-2) var(--spacing-3);
    font-size: var(--font-size-sm);
  }
}

.dropdown-menu {
  min-width: 200px;
  font-size: var(--font-size-sm);
}

.dropdown-item {
  padding: var(--spacing-2) var(--spacing-3);
}

.dropdown-item i {
  width: 16px;
  text-align: center;
}

.btn-group-sm .btn {
  white-space: nowrap;
  font-size: var(--font-size-xs);
}

code {
  background-color: var(--background-light);
  padding: var(--spacing-1) var(--spacing-2);
  border-radius: var(--radius-base);
  font-size: var(--font-size-xs);
  border: 1px solid var(--border-color);
}

/* Filter section spacing */
form.row {
  background: var(--background-light);
  padding: var(--spacing-3);
  border-radius: var(--radius-base);
  border: 1px solid var(--border-color);
}

form label {
  font-weight: 500;
}
</style>
{% endblock %}
