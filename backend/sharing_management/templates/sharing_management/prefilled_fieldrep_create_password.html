{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh; background: #f8f9fa;">
  <div class="card shadow" style="width: 100%; max-width: 420px;">
    <div class="card-body p-4">
      <h4 class="text-center mb-4">Field Rep Registration</h4>

      <p class="text-muted small mb-3">
        A system-generated password is shown below. You may use it, or create your own.
      </p>

      {% if error %}
      <div class="alert alert-danger" role="alert">
        {{ error }}
      </div>
      {% endif %}

      <form method="post" autocomplete="off" id="passwordForm">
        {% csrf_token %}

        <!-- Preserve email + campaign -->
        <input type="hidden" name="email" value="{{ email }}">
        {% if brand_campaign_id %}
        <input type="hidden" name="campaign" value="{{ brand_campaign_id }}">
        {% endif %}

        <!-- Match manual fields -->
        <div class="mb-3">
          <label class="form-label">Field ID:</label>
          <input
            type="text"
            class="form-control"
            name="field_id"
            placeholder="Enter your Field ID"
            value="{{ field_id|default:'' }}"
            required
          >
        </div>

        <div class="mb-3">
          <label class="form-label">Email ID:</label>
          <input type="email" class="form-control" value="{{ email }}" readonly>
        </div>

        <div class="mb-3">
          <label class="form-label">WhatsApp Number:</label>
          <input
            type="tel"
            class="form-control"
            name="whatsapp_number"
            placeholder="Enter WhatsApp number (e.g. 9876543210)"
            pattern="[0-9]{10,15}"
            title="Please enter a valid phone number (10-15 digits)"
            value="{{ whatsapp_number|default:'' }}"
          >
          <small class="form-text text-muted">
            Enter your WhatsApp number without country code (e.g. 9876543210)
          </small>
        </div>

        <!-- System password (default) -->
        <div class="mb-3">
          <label class="form-label">Password:</label>
          <input
            type="text"
            class="form-control"
            id="password"
            name="password"
            value="{{ password }}"
            required
            readonly
          >
          <small class="form-text text-muted">
            Use the system password as-is, or click “Create Your Password”.
          </small>
        </div>

        <div class="row mb-3">
          <div class="col-6">
            <button type="button" class="btn btn-secondary w-100" id="useSystemPassword">
              Use System Password
            </button>
          </div>
          <div class="col-6">
            <button type="button" class="btn btn-secondary w-100" id="createYourPassword">
              Create Your Password
            </button>
          </div>
        </div>

        <div class="mb-3" id="confirmPasswordDiv" style="display:none;">
          <label class="form-label">Confirm Password:</label>
          <input
            type="password"
            class="form-control"
            id="confirm_password"
            name="confirm_password"
            placeholder="Confirm password"
          >
        </div>

        <div class="mb-3">
          <label class="form-label">Security Question:</label>
          <select class="form-select" name="security_question" required>
            <option value="">-- Select Security Question --</option>
            {% for q in security_questions %}
              <option
                value="{{ q.id }}"
                {% if selected_security_question|default:''|stringformat:"s" == q.id|stringformat:"s" %}selected{% endif %}
              >
                {{ q.question_text }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Security Answer:</label>
          <input
            type="text"
            class="form-control"
            name="security_answer"
            placeholder="Enter your answer"
            value="{{ security_answer|default:'' }}"
            required
          >
        </div>

        <button type="submit" class="btn btn-primary w-100" style="background:#1877f2; border:none;">
          Register
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  const useSystemBtn = document.getElementById('useSystemPassword');
  const createYourBtn = document.getElementById('createYourPassword');
  const passwordInput = document.getElementById('password');
  const confirmDiv = document.getElementById('confirmPasswordDiv');
  const confirmInput = document.getElementById('confirm_password');

  // Remember the system password so we can restore it after switching modes
  const systemPassword = passwordInput.value;

  useSystemBtn.addEventListener('click', function () {
    passwordInput.value = systemPassword;
    passwordInput.readOnly = true;
    passwordInput.type = 'text';

    confirmDiv.style.display = 'none';
    confirmInput.value = '';
    confirmInput.required = false;
  });

  createYourBtn.addEventListener('click', function () {
    passwordInput.readOnly = false;
    passwordInput.value = '';
    passwordInput.type = 'password';

    confirmDiv.style.display = 'block';
    confirmInput.required = true;
  });
</script>
{% endblock %}
