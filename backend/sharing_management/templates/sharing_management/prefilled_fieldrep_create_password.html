{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-center align-items-center vh-100">
  <div class="card shadow" style="width: 100%; max-width: 450px;">
    <div class="card-body p-4">
      <h4 class="text-center mb-4">Create Password</h4>

      {% if error %}
        <div class="alert alert-danger" role="alert">{{ error }}</div>
      {% endif %}

      <form method="post" id="passwordForm" autocomplete="off">
        {% csrf_token %}

        <input type="hidden" name="email" value="{{ email }}">
        <input type="hidden" name="field_id" value="{{ field_id }}">
        {% if campaign %}
          <input type="hidden" name="campaign" value="{{ campaign }}">
        {% endif %}

        <div class="mb-3">
          <label class="form-label">Field ID:</label>
          <input type="text" class="form-control" value="{{ field_id }}" readonly>
        </div>

        <div class="mb-3">
          <label class="form-label">Email ID:</label>
          <input type="email" class="form-control" value="{{ email }}" readonly>
        </div>

        <div class="mb-3">
          <label class="form-label">Password:</label>
          <input
            type="text"
            class="form-control"
            name="password"
            id="password"
            value="{{ password }}"
            readonly
            required
          >
        </div>

        <div class="mb-3 text-center">
          <button type="button" class="btn btn-outline-primary btn-sm me-2" id="useSystemBtn">
            Use System Password
          </button>
          <button type="button" class="btn btn-outline-secondary btn-sm" id="createYourBtn">
            Create Your Own Password
          </button>
        </div>

        <div class="mb-3" id="confirmPasswordDiv" style="display: none;">
          <label class="form-label">Confirm Password:</label>
          <input
            type="text"
            class="form-control"
            name="confirm_password"
            id="confirm_password"
            placeholder="Re-enter your password"
          >
        </div>

        <button type="submit" class="btn btn-success w-100" style="background: #00897b; border: none;">
          Register
        </button>
      </form>
    </div>
  </div>
</div>

<script>
(function () {
  const useSystemBtn = document.getElementById("useSystemBtn");
  const createYourBtn = document.getElementById("createYourBtn");
  const passwordInput = document.getElementById("password");
  const confirmDiv = document.getElementById("confirmPasswordDiv");
  const confirmInput = document.getElementById("confirm_password");
  const form = document.getElementById("passwordForm");

  const systemPassword = passwordInput.value;

  useSystemBtn.addEventListener("click", function () {
    passwordInput.value = systemPassword;
    passwordInput.setAttribute("readonly", "readonly");
    confirmDiv.style.display = "none";
    confirmInput.value = "";
  });

  createYourBtn.addEventListener("click", function () {
    passwordInput.value = "";
    passwordInput.removeAttribute("readonly");
    confirmDiv.style.display = "block";
    passwordInput.focus();
  });

  form.addEventListener("submit", function (e) {
    if (confirmDiv.style.display !== "none") {
      if (!confirmInput.value) {
        e.preventDefault();
        alert("Please confirm your password.");
        confirmInput.focus();
        return;
      }
      if (passwordInput.value !== confirmInput.value) {
        e.preventDefault();
        alert("Passwords do not match.");
        confirmInput.focus();
        return;
      }
    }
  });
})();
</script>
{% endblock %}
