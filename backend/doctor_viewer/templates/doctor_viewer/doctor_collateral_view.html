{% extends "base.html" %}
{% load static %}

{% block content %}

{% if verified and collateral %}

<div class="container mt-4">
  <div class="card mx-auto" style="max-width: 800px">

    <div class="card-header text-center">
      <h4 class="mb-0">{{ collateral.title }}</h4>

      {% if collateral.description %}
        <p class="text-muted mb-0">{{ collateral.description }}</p>
      {% endif %}

      {% if collateral.doctor_name %}
        <p class="text-muted mb-0">By Dr. {{ collateral.doctor_name }}</p>
      {% endif %}
    </div>

    <div class="card-body text-center">

      {% if collateral.vimeo_url %}
        <div class="ratio ratio-16x9 mb-3">
          <iframe src="{{ collateral.vimeo_url }}" allowfullscreen></iframe>
        </div>
      {% endif %}

      {% if collateral.file %}
        <a
          href="{{ absolute_pdf_url|default:'#' }}"
          class="btn btn-primary mb-3"
          target="_blank"
          style="background: #1877f2; border: none"
        >
          CLICK HERE to download the PDF
        </a>

        <p>If you are not able to see the PDF, please refresh the page!</p>

        <div
          class="pdf-container"
          style="border: 1px solid #ccc; height: 600px; overflow: auto; background: #f8f9fa;"
        >
          <div class="pdf-controls bg-white p-2 border-bottom">
            <a
              href="{{ absolute_pdf_url|default:'#' }}"
              class="btn btn-outline-secondary btn-sm"
              target="_blank"
            >
              Open in New Tab
            </a>

            <a
              href="{{ absolute_pdf_url|default:'#' }}"
              class="btn btn-outline-success btn-sm"
              download
            >
              Download
            </a>
          </div>

          <iframe
            src="{{ absolute_pdf_url|default:'about:blank' }}"
            width="100%"
            height="100%"
            style="border: none;"
          ></iframe>
        </div>
      {% endif %}

      {% if not collateral.file and not collateral.vimeo_url %}
        <div class="alert alert-info">
          <h5>Content Preview</h5>
          <p><strong>Title:</strong> {{ collateral.title }}</p>
          {% if collateral.description %}
            <p><strong>Description:</strong> {{ collateral.description }}</p>
          {% endif %}
          <p><strong>Type:</strong> {{ collateral.type }}</p>
        </div>
      {% endif %}

    </div>

    {% if archives %}
      <hr class="my-4" />
      <div class="text-start">
        <h5 class="mb-3">Archives</h5>
        <div class="row g-3">
          {% for item in archives %}
            <div class="col-12 col-md-4">
              <div class="card h-100">
                <div class="card-body">
                  <h6 class="card-title">{{ item.obj.title }}</h6>
                </div>
                <div class="card-footer bg-white border-0">
                  {% if item.short_code %}
                    <a class="btn btn-sm btn-outline-primary w-100"
                       href="{% url 'resolve_shortlink' item.short_code %}">
                      Open
                    </a>
                  {% else %}
                    <button class="btn btn-sm btn-outline-secondary w-100" disabled>
                      No link available
                    </button>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

  </div>
</div>

{% else %}

<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
  <div class="card shadow" style="max-width: 400px;">
    <div class="card-body text-center">
      <h3>Access Denied</h3>
      <p class="text-muted">Please verify your WhatsApp number.</p>
      <a href="{% url 'doctor_collateral_verify' %}"
         class="btn btn-primary w-100"
         style="background: #1877f2;">
        Go Back to Verification
      </a>
    </div>
  </div>
</div>

{% endif %}

{% endblock %}
