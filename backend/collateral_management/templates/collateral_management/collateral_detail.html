{% extends "base.html" %}
{% block content %}
<div class="container">
    <h2>{{ collateral.title }}</h2>

    <div class="card">
        <div class="card-body">
            <p><strong>Type:</strong> {{ collateral.get_type_display }}</p>
            <p><strong>Content ID:</strong> {{ collateral.content_id|default:"N/A" }}</p>
            <p><strong>Upload Date:</strong> {{ collateral.upload_date }}</p>
            <p><strong>Status:</strong> {% if collateral.is_active %}Active{% else %}Inactive{% endif %}</p>

            <div class="mt-3">
                {% if collateral.file %}
                <div class="mb-4">
                    <h4>PDF Document</h4>
                    <div class="mt-2">
                        <a href="{{ absolute_pdf_url|default:collateral.file.url }}" class="btn btn-primary" target="_blank">View PDF</a>
                    </div>
                    <div class="mt-2">
                        <iframe src="{{ absolute_pdf_url|default:collateral.file.url }}#toolbar=0" width="100%" height="500px" class="border rounded">
                            Your browser does not support PDFs. <a href="{{ absolute_pdf_url|default:collateral.file.url }}">Download the PDF</a> instead.
                        </iframe>
                    </div>
                </div>
                {% endif %}

                {% if collateral.vimeo_url %}
                <div class="mt-4">
                    <h4>Video</h4>
                    <div class="mt-2">
                        {% if 'vimeo.com' in collateral.vimeo_url %}
                            {% with video_id=collateral.vimeo_url.split('/')|last %}
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe src="https://player.vimeo.com/video/{{ video_id }}" 
                                        width="100%" 
                                        height="400" 
                                        frameborder="0" 
                                        allow="autoplay; fullscreen; picture-in-picture" 
                                        allowfullscreen
                                        class="border rounded">
                                </iframe>
                            </div>
                            {% endwith %}
                        {% else %}
                            <a href="{{ collateral.vimeo_url }}" class="btn btn-primary" target="_blank">View Video</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>  <!-- Added closing div tag for mt-3 -->

            <div class="mt-4">
                <a href="{% url 'collateral_list' %}" class="btn btn-secondary">Back to List</a>
                {% if user.role == 'admin' %}
                <a href="{% url 'collateral_update' collateral.id %}" class="btn btn-warning">Edit</a>
                <a href="{% url 'collateral_delete' collateral.id %}" class="btn btn-danger">Delete</a>
                {% endif %}
                <a href="{% url 'share_content' %}?collateral_id={{ collateral.id }}" class="btn btn-success">Share</a>
            </div>
        </div>
    </div>

    {% if collateral.campaign_collaterals.all %}
    <div class="mt-4">
        <h3>Associated Campaigns</h3>
        <ul class="list-group">
            {% for cc in collateral.campaign_collaterals.all %}
            <li class="list-group-item">
                {{ cc.campaign.name }}
                {% if cc.start_date or cc.end_date %}
                <small>
                    ({% if cc.start_date %}From: {{ cc.start_date }}{% endif %}
                    {% if cc.end_date %} To: {{ cc.end_date }}{% endif %})
                </small>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}